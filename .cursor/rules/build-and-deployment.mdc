---
description:
globs:
alwaysApply: false
---
# Build and Deployment Patterns

All extensions follow the same build and deployment patterns. This process works with the entry points (see [entry-points.mdc](mdc:.cursor/rules/entry-points.mdc)), vite configs (see [vite-configuration.mdc](mdc:.cursor/rules/vite-configuration.mdc)), and manifests (see [manifest-patterns.mdc](mdc:.cursor/rules/manifest-patterns.mdc)).

## Build Scripts
Each extension has standard npm scripts in [package.json](mdc:package.json):
```json
{
  "scripts": {
    "dev": "vite",
    "dev:http": "vite --mode http", 
    "build": "vite build",
    "preview": "vite preview"
  }
}
```

## Global Build Script
The main build script is [scripts/build.sh](mdc:scripts/build.sh) which:
- Builds all extensions or specified extensions
- Runs npm install in each extension directory
- Cleans output directories before building
- Validates extension structure

## Build Output
All extensions output to `dist/{extension-name}/`:
- Compiled JavaScript files (.es.js)
- Copied manifest.json (see [manifest-patterns.mdc](mdc:.cursor/rules/manifest-patterns.mdc))
- CSS files (if any)

## Development Server
- All extensions use port 5173
- HTTPS enabled with localhost certificates
- CORS enabled for all origins
- HTTP-only mode available with `--mode http`

## Integration with Other Components
- **Entry Points**: Builds [entry-points.mdc](mdc:.cursor/rules/entry-points.mdc) files into .es.js
- **Vite Configs**: Uses [vite-configuration.mdc](mdc:.cursor/rules/vite-configuration.mdc) settings
- **Manifests**: Copies [manifest-patterns.mdc](mdc:.cursor/rules/manifest-patterns.mdc) to dist/
- **Structure**: Follows [extensions-structure.mdc](mdc:.cursor/rules/extensions-structure.mdc) patterns

## Validation
Use [scripts/validate-extensions.js](mdc:scripts/validate-extensions.js) to check:
- Required files exist (see [extensions-structure.mdc](mdc:.cursor/rules/extensions-structure.mdc))
- Package.json has build script
- Manifest.json has correct entrypoints (see [manifest-patterns.mdc](mdc:.cursor/rules/manifest-patterns.mdc))
- Extension structure is valid

## Common Build Commands
```bash
# Build all extensions
./scripts/build.sh

# Build specific extension
./scripts/build.sh pushups

# Build multiple extensions
./scripts/build.sh auth-button votes

# Serve built extensions
npm run serve
```

## Common Issues (see [common-issues.mdc](mdc:.cursor/rules/common-issues.mdc) for detailed solutions)
- Must run npm install in each extension directory
- Build output goes to dist/{extension-name}/
- Manifest.json is automatically copied during build
- All extensions use the same Vite configuration pattern

## When Working With Build Process
- **Creating new extension**: Follow [extensions-structure.mdc](mdc:.cursor/rules/extensions-structure.mdc) and build patterns
- **Debugging build issues**: Check [common-issues.mdc](mdc:.cursor/rules/common-issues.mdc) for build problems
- **Entry point changes**: Ensure [entry-points.mdc](mdc:.cursor/rules/entry-points.mdc) files are properly configured
- **Vite config updates**: Coordinate with [vite-configuration.mdc](mdc:.cursor/rules/vite-configuration.mdc) settings
